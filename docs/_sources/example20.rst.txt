Mixed Units in a Batch Reactor
------------------------------
:Files:
    `Ex_20_fed_batch_step.py <https://github.com/kwmcbride/kipet_examples/blob/master/examples/example_20/Ex_20_fed_batch_step.py>`_

In this example, we again look at the simple series reaction we have considered in many of the examples. The difference here is that we are modeling a batch reactor with a component feed that lasts only a portion of the reaction.

.. note::
    Since the ODEs are explicitly entered, the volume changes are not automatically added. In this example you can see that we did this manually.

::

    import kipet
    
    r1 = kipet.ReactionModel('reaction-1')
    r1.unit_base.time = 's'
    
    full_data = kipet.read_data('data/ratios.csv')
    
    # Add the model parameters
    k1 = r1.parameter('k1', value=2, bounds=(0.0, 10.0), units='1/s')
    k2 = r1.parameter('k2', value=0.2, bounds=(0.0, 10.0), units='1/s')
    
    # Declare the components and give the valueial values
    A = r1.component('A', value=1.0, units='mol/l')
    B = r1.component('B', value=0.0, units='mol/l')
    C = r1.component('C', value=0.0, units='mol/l')
    
    r1.add_data('C_data', data=full_data[['A']], remove_negatives=True)
    r1.add_data('y_data', data=full_data[['y']])
    
    r1.add_ode('A', -k1 * A )
    r1.add_ode('B', k1 * A - k2 * B )
    r1.add_ode('C', k2 * B )
    
    r1.add_expression('y', B/(B + C), description='Ratio of B to (B + C)' )
   
    r1.check_model_units()
    
    # Add the custom objective varibale to the model using the following method:
    r1.add_objective_from_algebraic('y')
    
    # Perform parameter fitting
    r1.run_opt()
    
    r1.results.show_parameters
    r1.plot()
	
.. figure:: ../../images/ex_2_C.svg
   :width: 600px
   :align: center

   Concentration profile results from tutorial example 2

.. figure:: ../../images/ex_2_S.svg
   :width: 600px
   :align: center

   Pure component absorbance profiles (S) result from tutorial example 2